<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công Cụ Tính Lợi Nhuận Dự Án</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
    <script>
        // Cấu hình Tailwind để mô phỏng theme của shadcn/UI
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        border: 'hsl(214.3, 31.8%, 91.4%)',
                        input: 'hsl(214.3, 31.8%, 91.4%)',
                        ring: 'hsl(222.2, 84%, 4.9%)',
                        background: 'hsl(0, 0%, 100%)',
                        foreground: 'hsl(222.2, 84%, 4.9%)',
                        primary: {
                            DEFAULT: 'hsl(222.2, 47.4%, 11.2%)',
                            foreground: 'hsl(210, 40%, 98%)',
                        },
                        secondary: {
                            DEFAULT: 'hsl(210, 40%, 96.1%)',
                            foreground: 'hsl(222.2, 47.4%, 11.2%)',
                        },
                        muted: {
                            DEFAULT: 'hsl(210, 40%, 96.1%)',
                            foreground: 'hsl(215.4, 16.3%, 46.9%)',
                        },
                        card: {
                            DEFAULT: 'hsl(0, 0%, 100%)',
                            foreground: 'hsl(222.2, 84%, 4.9%)',
                        },
                    },
                    borderRadius: {
                        lg: '0.5rem',
                        md: 'calc(0.5rem - 2px)',
                        sm: 'calc(0.5rem - 4px)',
                    },
                }
            }
        }
    </script>
</head>
<body class="bg-secondary/40 text-foreground antialiased">

    <div class="container mx-auto max-w-4xl p-4 md:p-8">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold tracking-tight text-primary">Công Cụ Tính Lợi Nhuận Dự Án</h1>
            <p class="text-muted-foreground mt-2">Nhập thông tin dự án và lợi nhuận để xem phân bổ chi tiết.</p>
        </header>

        <main class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Cột nhập liệu -->
            <div class="space-y-6">
                <div class="bg-card text-card-foreground border border-border rounded-lg shadow-sm">
                    <div class="p-6">
                        <h3 class="text-lg font-semibold">Thông tin dự án</h3>
                    </div>
                    <div class="p-6 pt-0 space-y-4">
                        <div>
                            <label for="projectName" class="text-sm font-medium leading-none">Tên dự án</label>
                            <input type="text" id="projectName" value="Website Bán Hàng ABC" class="mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2">
                        </div>
                        <div>
                            <label for="totalProfit" class="text-sm font-medium leading-none">Tổng lợi nhuận (VNĐ)</label>
                            <input type="text" inputmode="numeric" id="totalProfit" value="100000000" class="mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2">
                        </div>
                    </div>
                </div>

                <div class="bg-card text-card-foreground border border-border rounded-lg shadow-sm">
                    <div class="p-6">
                        <h3 class="text-lg font-semibold">Cấu hình nhân sự</h3>
                    </div>
                    <div class="p-6 pt-0 grid grid-cols-2 gap-4">
                        <div>
                            <label for="salesCount" class="text-sm font-medium leading-none">Team Sale</label>
                            <input type="number" id="salesCount" value="3" min="1" class="mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2">
                        </div>
                         <div>
                            <label for="projectLead" class="text-sm font-medium leading-none">Người mang dự án</label>
                            <select id="projectLead" class="mt-1 flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2">
                                <!-- Options will be generated by JS -->
                            </select>
                        </div>
                        <div>
                            <label for="itCount" class="text-sm font-medium leading-none">Team IT</label>
                            <input type="number" id="itCount" value="2" min="0" class="mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2">
                        </div>
                        <div>
                            <label for="designCount" class="text-sm font-medium leading-none">Team Design</label>
                            <input type="number" id="designCount" value="1" min="0" class="mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2">
                        </div>
                        <div>
                            <label for="accountantCount" class="text-sm font-medium leading-none">Team Kế toán</label>
                            <input type="number" id="accountantCount" value="1" min="0" class="mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2">
                        </div>
                    </div>
                     <div class="p-6 pt-0">
                         <button id="calculateBtn" class="w-full bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 rounded-md text-sm font-medium">Tính toán</button>
                    </div>
                </div>
            </div>

            <!-- Cột kết quả -->
            <div id="results-container" class="bg-card text-card-foreground border border-border rounded-lg shadow-sm hidden">
                <div class="p-6">
                    <h3 class="text-lg font-semibold">Kết quả phân bổ lợi nhuận</h3>
                    <p id="projectNameResult" class="text-sm text-muted-foreground"></p>
                </div>
                <div id="results-content" class="p-6 pt-0 space-y-6">
                    <!-- Results will be injected here -->
                </div>
            </div>
        </main>
        
        <footer class="text-center mt-12 text-sm text-muted-foreground">
            <p>Được tạo bởi Gemini. Giao diện lấy cảm hứng từ shadcn/ui.</p>
        </footer>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const projectNameInput = document.getElementById('projectName');
            const totalProfitInput = document.getElementById('totalProfit');
            const salesCountInput = document.getElementById('salesCount');
            const projectLeadSelect = document.getElementById('projectLead');
            const itCountInput = document.getElementById('itCount');
            const designCountInput = document.getElementById('designCount');
            const accountantCountInput = document.getElementById('accountantCount');
            const calculateBtn = document.getElementById('calculateBtn');
            const resultsContainer = document.getElementById('results-container');
            const projectNameResult = document.getElementById('projectNameResult');
            const resultsContent = document.getElementById('results-content');
            
            // Hàm định dạng tiền tệ
            const currencyFormatter = new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND',
                minimumFractionDigits: 0
            });

            // Hàm định dạng số với dấu chấm cho ô nhập liệu
            function formatNumberInput(input) {
                // Lấy giá trị, xoá ký tự không phải số để lấy số nguyên
                let rawValue = input.value.replace(/\D/g, '');

                if (rawValue) {
                    // Định dạng số với dấu chấm phân cách hàng nghìn (sử dụng locale 'de-DE' cho dấu chấm)
                    input.value = parseInt(rawValue, 10).toLocaleString('de-DE');
                } else {
                    input.value = '';
                }
            }

            // Thêm sự kiện 'blur' để tự động định dạng sau khi người dùng nhập xong
            totalProfitInput.addEventListener('blur', () => {
                formatNumberInput(totalProfitInput);
            });

            // Cập nhật danh sách người mang dự án
            function updateProjectLeadOptions() {
                const salesCount = parseInt(salesCountInput.value) || 0;
                projectLeadSelect.innerHTML = '';
                if (salesCount > 0) {
                    for (let i = 1; i <= salesCount; i++) {
                        const option = document.createElement('option');
                        option.value = i;
                        option.textContent = `Sale ${String.fromCharCode(64 + i)}`; // A, B, C...
                        projectLeadSelect.appendChild(option);
                    }
                     projectLeadSelect.disabled = false;
                } else {
                     const option = document.createElement('option');
                     option.textContent = `Không có team Sale`;
                     projectLeadSelect.appendChild(option);
                     projectLeadSelect.disabled = true;
                }
            }

            salesCountInput.addEventListener('input', updateProjectLeadOptions);

            // Hàm tính toán và hiển thị
            function calculateAndDisplay() {
                // Lấy giá trị đầu vào
                const projectName = projectNameInput.value || "Dự án không tên";
                // Chuyển đổi giá trị đã định dạng (ví dụ: '100.000.000') thành số trước khi tính
                const totalProfit = parseFloat(totalProfitInput.value.replace(/\./g, '')) || 0;
                const salesCount = parseInt(salesCountInput.value) || 0;
                const projectLeadIndex = parseInt(projectLeadSelect.value) -1; // 0-based index
                const itCount = parseInt(itCountInput.value) || 0;
                const designCount = parseInt(designCountInput.value) || 0;
                const accountantCount = parseInt(accountantCountInput.value) || 0;

                if (totalProfit <= 0) {
                    resultsContent.innerHTML = `<p class="text-sm text-red-600">Vui lòng nhập tổng lợi nhuận lớn hơn 0.</p>`;
                    resultsContainer.classList.remove('hidden');
                    return;
                }

                // Công thức tính toán
                const salePot = totalProfit * 0.35;
                const boPot = totalProfit * 0.15;
                const shareholderPot = totalProfit * 0.10;
                const remainingPot = totalProfit * 0.40;

                // Tính toán cho team Sale
                let saleResults = [];
                if (salesCount > 0) {
                    // Người mang dự án được thưởng 5% trên quỹ của team Sale
                    const leadBonus = salePot * 0.05;
                    const remainingSalePot = salePot - leadBonus;
                    const baseSaleShare = remainingSalePot / salesCount;
                    
                    for (let i = 0; i < salesCount; i++) {
                        let finalShare = baseSaleShare;
                        let isLead = i === projectLeadIndex;
                        if (isLead) {
                            finalShare += leadBonus;
                        }
                        saleResults.push({
                            name: `Sale ${String.fromCharCode(65 + i)}`,
                            share: finalShare,
                            isLead: isLead
                        });
                    }
                }

                // Tính toán cho team BO
                const boCount = itCount + designCount + accountantCount;
                const boSharePerMember = boCount > 0 ? boPot / boCount : 0;
                
                // Hiển thị kết quả
                projectNameResult.textContent = `Dành cho dự án: "${projectName}"`;
                resultsContent.innerHTML = `
                    <div class="space-y-4">
                        <!-- Tổng quan -->
                        <div>
                            <h4 class="font-medium mb-2">Tổng quan phân bổ</h4>
                            <ul class="text-sm space-y-1 text-muted-foreground">
                                <li class="flex justify-between"><span>Team Sale (35%):</span> <span class="font-semibold text-foreground">${currencyFormatter.format(salePot)}</span></li>
                                <li class="flex justify-between"><span>Team BO (15%):</span> <span class="font-semibold text-foreground">${currencyFormatter.format(boPot)}</span></li>
                                <li class="flex justify-between"><span>Cổ đông (10%):</span> <span class="font-semibold text-foreground">${currencyFormatter.format(shareholderPot)}</span></li>
                                <li class="flex justify-between"><span>Quỹ còn lại (40%):</span> <span class="font-semibold text-foreground">${currencyFormatter.format(remainingPot)}</span></li>
                            </ul>
                        </div>
                        <div class="border-b border-border"></div>
                        
                        <!-- Chi tiết Team Sale -->
                        ${saleResults.length > 0 ? `
                        <div>
                            <h4 class="font-medium mb-2">Chi tiết Team Sale</h4>
                            <ul class="text-sm space-y-1 text-muted-foreground">
                                ${saleResults.map(sale => `
                                    <li class="flex justify-between">
                                        <span>
                                            ${sale.name} ${sale.isLead ? '<span class="text-xs font-semibold text-primary/80 bg-primary/10 px-2 py-0.5 rounded-full ml-1">Người mang dự án</span>' : ''}
                                        </span> 
                                        <span class="font-semibold text-foreground">${currencyFormatter.format(sale.share)}</span>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                        <div class="border-b border-border"></div>
                        ` : ''}

                        <!-- Chi tiết Team BO -->
                        ${boCount > 0 ? `
                        <div>
                            <h4 class="font-medium mb-2">Chi tiết Team BO (Back Office)</h4>
                            <p class="text-sm text-muted-foreground">Tổng số <strong>${boCount}</strong> thành viên (IT: ${itCount}, Design: ${designCount}, Kế toán: ${accountantCount}).</p>
                            <p class="text-sm text-muted-foreground mt-1">Mỗi thành viên nhận: <strong class="text-foreground">${currencyFormatter.format(boSharePerMember)}</strong></p>
                        </div>
                        <div class="border-b border-border"></div>
                        ` : ''}

                        <!-- Chi tiết Cổ đông -->
                        <div>
                            <h4 class="font-medium mb-2">Cổ đông</h4>
                             <p class="text-sm text-muted-foreground">Tổng quỹ: <strong class="text-foreground">${currencyFormatter.format(shareholderPot)}</strong></p>
                        </div>
                    </div>
                `;
                resultsContainer.classList.remove('hidden');
            }

            calculateBtn.addEventListener('click', calculateAndDisplay);
            
            // Khởi tạo và chạy lần đầu
            updateProjectLeadOptions();
            formatNumberInput(totalProfitInput); // Định dạng giá trị ban đầu cho ô lợi nhuận
            calculateAndDisplay();
        });
    </script>
</body>
</html>


